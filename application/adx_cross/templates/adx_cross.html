{% extends 'template.j2' %}
{% block head %}
<style>
#main {
	background-color: #FFFFFF;
	border-radius: 10px;
}
</style>
{% endblock %}
{% block body %}
<div id='main' class='container bg-light'>
	<h1 class='text-center'>ADX Cross</h1>
	<p class='text-center'>Updated as of : <b>{{ db.last_pull_pretty }}</b><br><button id='refresh' class='btn btn-primary' onclick='javascript:get_last_pull()'>Refresh</button></p>
    <table class='table table-bordered'>
        <!-- Put Something in this TR -->
        <tr>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Type</th>
            <th>DMI</th>
            <th>StochRSI</th>
            <th>ADX</th>
            <th>Pick</th>
        </tr>
        {% for pick in picks %}
        <!-- {{ pick | safe }} -->
        <tr>
            <td>{{ pick.symbol }}</td>
            <td>{{ pick.strike }}</td>
            <td>{{ pick.type }}</td>
            {% if pick.dmi %}
            <td class='bg-success text-bg-success'>{{ pick.dmi }}</td>
            {% else %}
            <td class='bg-danger text-bg-danger'>{{ pick.dmi }}</td>
            {% endif %}
            {% if pick.rsi %}
            <td class='bg-success text-bg-success'>{{ pick.rsi }}</td>
            {% else %}
            <td class='bg-danger text-bg-danger'>{{ pick.rsi }}</td>
            {% endif %}
            {% if pick.adx %}
            <td class='bg-success text-bg-success'>{{ pick.adx }}</td>
            {% else %}
            <td class='bg-danger text-bg-danger'>{{ pick.adx }}</td>
            {% endif %}
            {% if pick.bang %}
            <td class='bg-success text-bg-success'>{{ pick.bang }}</td>
            {% else %}
            <td class='bg-danger text-bg-danger'>{{ pick.bang }}</td>
            {% endif %}
        </tr>
        {% endfor %}
    </table>
    <br>
</div>

<script>

function test() {
    alert('test');
}

function get_last_pull() {  
    let options = {
        method: 'GET',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'}
    };
    var btn = document.getElementById('refresh');
    btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Loading...';
    btn.disabled = true;
    
    fetch("/api/update", options)
    .then((response) => response.json())
    .then(data => {
        var jd = JSON.stringify(data);
        console.log(jd);
        window.location.reload();
    }).catch((error) => {
        console.log(error);
    })
    return;
}

</script>

{% endblock %}